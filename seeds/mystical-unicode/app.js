const SP = String.prototype

SP.r = SP.replace
SP.rA = SP.replaceAll

const mapUnicode = (str, fromArr, toArr) => {
	const map = Object.create(null)
	fromArr.forEach((c, i) => { map[c] = toArr[i] })
	return Array.from(str, ch => map[ch] ?? ch).join('')
}

const applyNumsThenLetters = (str, numsFrom, numsTo, lettersFrom, lettersTo) => {
	if (numsFrom && numsTo) str = mapUnicode(str, numsFrom, numsTo)
	if (lettersFrom && lettersTo) str = mapUnicode(str, lettersFrom, lettersTo)
	return str
}

SP.textFormatted = function(){

	let abc = (
		'a,Ã¡,Ã¤,b,c,d,e,Ã©,Ã«,f,g,h,i,Ã­,Ã¯,j,k,l,m,n,Ã±,o,Ã³,Ã¶,p,q,r,s,t,u,Ãº,Ã¼,v,w,x,y,z,'+
		'A,Ã,Ã„,B,C,D,E,Ã‰,Ã‹,F,G,H,I,Ã,Ã,J,K,L,M,N,Ã‘,O,Ã“,Ã–,P,Q,R,S,T,U,Ãš,Ãœ,V,W,X,Y,Z'
	).split(',')

	let abcSimple = (
		'abcdefghijklmnopqrstuvwxyz'+
		'ABCDEFGHIJKLMNOPQRSTUVWXYZ'+
		'0123456789'
	).split('')

	let NUM = '0,1,2,3,4,5,6,7,8,9'.split(',')

	let BOLD = (
		'ð—®,Ã¡,Ã¤,ð—¯,ð—°,ð—±,ð—²,Ã©,Ã«,ð—³,ð—´,ð—µ,ð—¶,Ã­,Ã¯,ð—·,ð—¸,ð—¹,ð—º,ð—»,Ã±,ð—¼,Ã³,Ã¶,ð—½,ð—¾,ð—¿,ð˜€,ð˜,ð˜‚,Ãº,Ã¼,ð˜ƒ,ð˜„,ð˜…,ð˜†,ð˜‡,'+
		'ð—”,Ã,Ã„,ð—•,ð—–,ð——,ð—˜,Ã‰,Ã‹,ð—™,ð—š,ð—›,ð—œ,Ã,Ã,ð—,ð—ž,ð—Ÿ,ð— ,ð—¡,Ã‘,ð—¢,Ã“,Ã–,ð—£,ð—¤,ð—¥,ð—¦,ð—§,ð—¨,Ãš,Ãœ,ð—©,ð—ª,ð—«,ð—¬,ð—­,'+
		'ðŸ¬,ðŸ­,ðŸ®,ðŸ¯,ðŸ°,ðŸ±,ðŸ²,ðŸ³,ðŸ´,ðŸµ'
	).split(',')

	let ITATIC = (
		'ð˜¢,Ã¡,Ã¤,ð˜£,ð˜¤,ð˜¥,ð˜¦,Ã©,Ã«,ð˜§,ð˜¨,ð˜©,ð˜ª,Ã­,Ã¯,ð˜«,ð˜¬,ð˜­,ð˜®,ð˜¯,Ã±,ð˜°,Ã³,Ã¶,ð˜±,ð˜²,ð˜³,ð˜´,ð˜µ,ð˜¶,Ãº,Ã¼,ð˜·,ð˜¸,ð˜¹,ð˜º,ð˜»,'+
		'ð˜ˆ,Ã,Ã„,ð˜‰,ð˜Š,ð˜‹,ð˜Œ,Ã‰,Ã‹,ð˜,ð˜Ž,ð˜,ð˜,Ã,Ã,ð˜‘,ð˜’,ð˜“,ð˜”,ð˜•,Ã‘,ð˜–,Ã“,Ã–,ð˜—,ð˜˜,ð˜™,ð˜š,ð˜›,ð˜œ,Ãš,Ãœ,ð˜,ð˜ž,ð˜Ÿ,ð˜ ,ð˜¡'
	).split(',')

	let ITATIC_BOLD = (
		'ð™–,Ã¡,Ã¤,ð™—,ð™˜,ð™™,ð™š,Ã©,Ã«,ð™›,ð™œ,ð™,ð™ž,Ã­,Ã¯,ð™Ÿ,ð™ ,ð™¡,ð™¢,ð™£,Ã±,ð™¤,Ã³,Ã¶,ð™¥,ð™¦,ð™§,ð™¨,ð™©,ð™ª,Ãº,Ã¼,ð™«,ð™¬,ð™­,ð™®,ð™¯,'+
		'ð˜¼,Ã,Ã„,ð˜½,ð˜¾,ð˜¿,ð™€,Ã‰,Ã‹,ð™,ð™‚,ð™ƒ,ð™„,Ã,Ã,ð™…,ð™†,ð™‡,ð™ˆ,ð™‰,Ã‘,ð™Š,Ã“,Ã–,ð™‹,ð™Œ,ð™,ð™Ž,ð™,ð™,Ãš,Ãœ,ð™‘,ð™’,ð™“,ð™”,ð™•'
	).split(',')

	let HIGHTLIGHT = (
		'ð•’,Ã¡,Ã¤,ð•“,ð•”,ð••,ð•–,Ã©,Ã«,ð•—,ð•˜,ð•™,ð•š,Ã­,Ã¯,ð•›,ð•œ,ð•,ð•ž,ð•Ÿ,Ã±,ð• ,Ã³,Ã¶,ð•¡,ð•¢,ð•£,ð•¤,ð•¥,ð•¦,Ãº,Ã¼,ð•§,ð•¨,ð•©,ð•ª,ð•«,'+
		'ð”¸,Ã,Ã„,ð”¹,â„‚,ð”»,ð”¼,Ã‰,Ã‹,ð”½,ð”¾,â„,ð•€,Ã,Ã,ð•,ð•‚,ð•ƒ,ð•„,â„•,Ã‘,ð•†,Ã“,Ã–,â„™,â„š,â„,ð•Š,ð•‹,ð•Œ,Ãš,Ãœ,ð•,ð•Ž,ð•,ð•,â„¤,'+
		'ðŸ˜,ðŸ™,ðŸš,ðŸ›,ðŸœ,ðŸ,ðŸž,ðŸŸ,ðŸ ,ðŸ¡'
	).split(',')

	let MONOSPACE = (
		'ðšŠ,Ã¡,Ã¤,ðš‹,ðšŒ,ðš,ðšŽ,Ã©,Ã«,ðš,ðš,ðš‘,ðš’,Ã­,Ã¯,ðš“,ðš”,ðš•,ðš–,ðš—,Ã±,ðš˜,Ã³,Ã¶,ðš™,ðšš,ðš›,ðšœ,ðš,ðšž,Ãº,Ã¼,ðšŸ,ðš ,ðš¡,ðš¢,ðš£,'+
		'ð™°,Ã,Ã„,ð™±,ð™²,ð™³,ð™´,Ã‰,Ã‹,ð™µ,ð™¶,ð™·,ð™¸,Ã,Ã,ð™¹,ð™º,ð™»,ð™¼,ð™½,Ã‘,ð™¾,Ã“,Ã–,ð™¿,ðš€,ðš,ðš‚,ðšƒ,ðš„,Ãš,Ãœ,ðš…,ðš†,ðš‡,ðšˆ,ðš‰,'+
		'ðŸ¶,ðŸ·,ðŸ¸,ðŸ¹,ðŸº,ðŸ»,ðŸ¼,ðŸ½,ðŸ¾,ðŸ¿'
	).split(',')

	let FULLSPACE = (
		'ï½,ï½‚,ï½ƒ,ï½„,ï½…,ï½†,ï½‡,ï½ˆ,ï½‰,ï½Š,ï½‹,ï½Œ,ï½,ï½Ž,ï½,ï½,ï½‘,ï½’,ï½“,ï½”,ï½•,ï½–,ï½—,ï½˜,ï½™,ï½š,'+
		'ï¼¡,ï¼¢,ï¼£,ï¼¤,ï¼¥,ï¼¦,ï¼§,ï¼¨,ï¼©,ï¼ª,ï¼«,ï¼¬,ï¼­,ï¼®,ï¼¯,ï¼°,ï¼±,ï¼²,ï¼³,ï¼´,ï¼µ,ï¼¶,ï¼·,ï¼¸,ï¼¹,ï¼º,'+
		'ï¼,ï¼‘,ï¼’,ï¼“,ï¼”,ï¼•,ï¼–,ï¼—,ï¼˜,ï¼™'
	).split(',')

	let TITLE = (
		'ðš,ð›,ðœ,ð,ðž,ðŸ,ð ,ð¡,ð¢,ð£,ð¤,ð¥,ð¦,ð§,ð¨,ð©,ðª,ð«,ð¬,ð­,ð®,ð¯,ð°,ð±,ð²,ð³,'+
		'ð€,ð,ð‚,ðƒ,ð„,ð…,ð†,ð‡,ðˆ,ð‰,ðŠ,ð‹,ðŒ,ð,ðŽ,ð,ð,ð‘,ð’,ð“,ð”,ð•,ð–,ð—,ð˜,ð™,'+
		'ðŸŽ,ðŸ,ðŸ,ðŸ‘,ðŸ’,ðŸ“,ðŸ”,ðŸ•,ðŸ–,ðŸ—'
	).split(',')

	let inputString = this
		.r(/^===+$/gm,'â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬')
		.r(/^---+$/gm,'â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”')
		
		.r(/\*\*\*([^\*\n]+)\*\*\*/g, m =>
			applyNumsThenLetters(m.slice(3,-3), NUM, ITATIC_BOLD.slice(-10), abc, ITATIC_BOLD)
		)
		.r(/\*\*([^\*\n]+)\*\*/g, m =>
			applyNumsThenLetters(m.slice(2,-2), NUM, BOLD.slice(-10), abc, BOLD)
		)
		.r(/\*([^\*\n]+)\*/g, m =>
			applyNumsThenLetters(m.slice(1,-1), null, null, abc, ITATIC)
		)
		.r(/`([^\n`]*)`/g, m =>
			'[ ' + applyNumsThenLetters(m.slice(1,-1), NUM, MONOSPACE.slice(-10), abc, MONOSPACE) + ' ]'
		)
		.r(/=([^\n=]*)=/g, m =>
			applyNumsThenLetters(m.slice(1,-1), NUM, HIGHTLIGHT.slice(-10), abc, HIGHTLIGHT)
		)
		.r(/\^([^\^\n]+)\^/g, m =>
			applyNumsThenLetters(m.slice(1,-1), NUM, FULLSPACE.slice(-10), abcSimple, FULLSPACE)
		)
		.r(/^# (.+)$/gmi, m =>
			'â–¶  '+applyNumsThenLetters(m.replace(/^# /,''), NUM, BOLD.slice(-10), abc, BOLD)
		)
		.r(/^## (.+)$/gmi, m =>
			'â–·  '+applyNumsThenLetters(m.replace(/^## /,''), NUM, BOLD.slice(-10), abc, BOLD)
		)
		.r(/^### (.+)$/gmi, m =>
			'â–“  '+applyNumsThenLetters(m.replace(/^### /,''), NUM, TITLE.slice(-10), abcSimple, TITLE)
		)
		.r(/^#### (.+)$/gmi, m =>
			'â–’  '+applyNumsThenLetters(m.replace(/^#### /,''), NUM, TITLE.slice(-10), abcSimple, TITLE)
		)

		.r(/"([^"]*)"/g, 'â€œ$1â€')
		.r(/'([^']*)'/g, 'â€˜$1â€™')

		.r(/^> -/gm, 'â–Œ â€”')
		.r(/^> /gm, 'â–Œ ')
		.r(/^\s?\* /gm, '   â€¢   ')
		.rA('<-', 'â†')
		.rA('->', 'â†’')
		.rA('<', 'â‰º')
		.rA('>', 'â‰»')
		.r(/-([^\-\n]*)-/g, (i,m) => {
		  return m.split('').join('Ì¶') +'Ì¶'
		})
		.r(/_([^_\n]*)_/g, (i,m) => {
		  return m.split('').join('Ì²') + 'Ì²'
		})


	return inputString
}
