<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload libGTASA.lst</title>
    <style>
        #output {
            height: 14rem;
            overflow-y: auto;
        }
        .pagination {
            margin-top: 10px;
            overflow: auto;
            display: flex;
        }
        .pagination button {
            margin: 0 2px;
            padding: .5rem;
        }
        
    </style>
    <link rel="stylesheet" href="./../../css/main.css">
</head>
<body class="d-block py-3">
    <h1>Upload libGTASA.lst</h1>
    <p>Recommended minimum requirements.</p>
    <p>6GB of RAM and any 2GHz OctaCore processor.<br>
    For the file to be processed in 7 seconds.</p>
    <input type="file" id="fileInput" accept=".lst">
    <button onclick="processFile()">process file</button><br>
    <p>The page may close on the first attempt.<br>
    Since everything operates on the same device.</p>
    <button onclick="downloadHTML()">download HTML</button>
    <pre id="output"></pre>
    <div class="pagination" id="pagination"></div>

    <script>
        let dividedLines = [];
        let currentPage = 0;
        const maxBytesPerPage = 1 * 1024 * 1024; // 1 MB

        function processFile() {
            const fileInput = document.getElementById('fileInput');
            const output = document.getElementById('output');

            output.textContent = 'loading...\nWait plis';
            if (!fileInput.files.length) {
                alert('Por favor, selecciona un archivo.');
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();
            let currentChunkSize = 0;
            let currentChunk = '';

            reader.onload = function(event) {
                const text = event.target.result;
                let startIndex = 0;

                // Dividir el archivo en partes de hasta 1 MB de manera más eficiente
                while (startIndex < text.length) {
                    let endIndex = startIndex + maxBytesPerPage;
                    if (endIndex > text.length) {
                        endIndex = text.length;
                    }

                    dividedLines.push(text.slice(startIndex, endIndex));
                    startIndex = endIndex;
                }

                currentPage = 0;
                renderPage();
                renderPagination();
            };

            reader.readAsText(file);
        }

        function renderPage() {
            const output = document.getElementById('output');
            output.textContent = dividedLines[currentPage] || '';
        }

        function renderPagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            // Crear botones de paginación según la cantidad de páginas
            for (let i = 0; i < dividedLines.length; i++) {
                const button = document.createElement('button');
                button.textContent = i + 1;
                button.onclick = () => {
                    currentPage = i;
                    renderPage();
                };
                pagination.appendChild(button);
            }
        }

        function downloadHTML() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sitio_actual.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
    <script src="../cleo-compiler/js/css.min.js"></script>
</body>
</html>